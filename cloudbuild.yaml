steps:
- name: gcr.io/cloud-builders/docker
  args: ['build', '-t', 'gcr.io/event-management-system-430621/event-management-system2:$COMMIT_SHA', '.']
  id: 'Build Docker image'

- name: gcr.io/cloud-builders/docker
  args: ['push', 'gcr.io/event-management-system-430621/event-management-system2:$COMMIT_SHA']
  id: 'Push Docker image'

- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk:slim'
  entrypoint: gcloud
  args: ['run', 'deploy', 'event-management-system2',
         '--image', 'gcr.io/event-management-system-430621/event-management-system2:$COMMIT_SHA',
         '--platform', 'managed',
         '--region', 'us-central1',
         '--allow-unauthenticated',
         '--add-cloudsql-instances', 'event-management-system-430621:us-central1:eventmanagementsystem',
         '--set-env-vars', 'SQL_CONNECTION_STRING=Server=tcp:34.44.194.190,1433;Database=EventManagementFinalNewNew;User Id=sqlserver;Password=event@123;TrustServerCertificate=True;',
         '--set-env-vars', 'ASPNETCORE_ENVIRONMENT=Development',
         '--port', '8080']
  id: 'Deploy to Cloud Run'
  
images:
- 'gcr.io/event-management-system-430621/event-management-system2:$COMMIT_SHA'

timeout: 1200s
